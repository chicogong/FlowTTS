# 字符计算规则

本文档说明 FlowTTS 中文本字符数的计算规则。

## 计算规则

| 字符类型 | 计费字符数 | 示例 |
|----------|------------|------|
| 汉字（CJK统一表意文字） | 2 | 你、好、世、界 |
| 英文字母 | 1 | a-z, A-Z |
| 数字 | 1 | 0-9 |
| 标点符号 | 1 | , . ! ? ; : 等 |
| 空白字符 | 1 | 空格、回车、制表符 |
| 其他符号 | 1 | @ # $ % & * 等 |

## 汉字范围

汉字的判定范围为 **CJK统一表意文字**：

- Unicode 范围：`U+4E00` - `U+9FFF`
- 包含约 20,000+ 常用汉字

## 计算示例

| 文本 | 计算过程 | 字符数 |
|------|----------|--------|
| `你好` | 2 + 2 | 4 |
| `Hello` | 1 + 1 + 1 + 1 + 1 | 5 |
| `你好World` | 2 + 2 + 1 + 1 + 1 + 1 + 1 | 9 |
| `Hello World` | 5个字母 + 1空格 + 5个字母 | 11 |
| `你好，世界！` | 4个汉字×2 + 2个标点×1 | 10 |

## 代码实现

```python
def calculate_char_count(text: str) -> int:
    """计算字符数（汉字算2个字符，其他字符算1个字符）"""
    if not text:
        return 0

    char_count = 0
    for c in text:
        # 汉字（CJK统一表意文字）算2个字符
        if '\u4e00' <= c <= '\u9fff':
            char_count += 2
        # 其他所有字符算1个字符
        else:
            char_count += 1

    return char_count
```

## 注意事项

1. **空文本**：空字符串返回 0
2. **表情符号**：Emoji 等非 CJK 字符按 1 个字符计算
3. **全角字符**：全角英文/数字不在 CJK 范围内，按 1 个字符计算
4. **日韩汉字**：在 CJK 范围内的日韩汉字按 2 个字符计算
